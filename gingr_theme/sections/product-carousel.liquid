{%- comment -%}
  Product Carousel 
{%- endcomment -%}

<section class="section-padding overflow-hidden" data-section-id="{{ section.id }}">
  <div class="gingr-container">
    {% if section.settings.heading != blank %}
      <div class="text-center mb-10">
        <h2 class="text-2xl md:text-3xl font-bold">{{ section.settings.heading }}</h2>
        {% if section.settings.subheading != blank %}
          <p class="text-sm text-subheading mt-2 max-w-md mx-auto">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    {%- comment -%} Carousel wrapper {%- endcomment -%}
    <div class="relative" data-product-carousel>
      {%- comment -%} Track {%- endcomment -%}
      <div class="flex gap-6 overflow-x-auto snap-x snap-mandatory scroll-smooth pb-6 -mb-6 carousel-track" data-carousel-track style="scrollbar-width: none;">
        {% for block in section.blocks %}
          {%- assign bg_from = block.settings.color_from | default: '#ffd400' -%}
          {%- assign bg_to = block.settings.color_to | default: '#c6a600' -%}

          <div class="carousel-slide snap-center flex-shrink-0 w-[85vw] sm:w-[70vw] md:w-[55vw] lg:w-[45vw]" {{ block.shopify_attributes }}>
            <div class="relative rounded-3xl overflow-hidden min-h-[380px] md:min-h-[420px]"
                 style="background: linear-gradient(135deg, {{ bg_from }}, {{ bg_to }});">

              {%- comment -%} Product image ‚Äî right side, contained inside card {%- endcomment -%}
              {% if block.settings.image %}
                <div class="absolute right-0 bottom-0 w-[50%] md:w-[45%] h-full pointer-events-none z-0 flex items-end justify-end">
                  {{ block.settings.image | image_url: width: 700 | image_tag:
                    class: 'w-full h-auto drop-shadow-2xl max-h-[95%] object-contain',
                    loading: 'lazy',
                    widths: '300,500,700'
                  }}
                </div>
              {% endif %}

              {%- comment -%} Content ‚Äî left side, full height flex {%- endcomment -%}
              <div class="relative z-10 p-6 md:p-8 flex flex-col h-full min-h-[380px] md:min-h-[420px] max-w-[58%]">

                {%- comment -%} Top: Badge {%- endcomment -%}
                {% if block.settings.badge != blank %}
                  <span class="self-start bg-white/20 backdrop-blur-sm text-[11px] font-bold px-3 py-1 rounded-full text-white mb-4">
                    {{ block.settings.badge }}
                  </span>
                {% endif %}

                {%- comment -%} Middle: Title + description + ingredients {%- endcomment -%}
                <div class="flex-1 flex flex-col justify-center">
                  <h3 class="text-2xl md:text-3xl font-bold text-white leading-tight">{{ block.settings.title }}</h3>

                  {% if block.settings.subtitle != blank %}
                    <p class="text-sm text-white/80 mt-3 leading-relaxed">{{ block.settings.subtitle }}</p>
                  {% endif %}

                  {% if block.settings.ingredients != blank %}
                    <p class="text-xs text-white/50 mt-3 font-medium tracking-wide">{{ block.settings.ingredients }}</p>
                  {% endif %}
                </div>

                {%- comment -%} Bottom: CTAs + eyebrow {%- endcomment -%}
                <div class="mt-auto pt-4">
                  <div class="flex flex-wrap items-center gap-2">
                    {%- comment -%} Add to cart (if product linked) {%- endcomment -%}
                    {% if block.settings.product != blank %}
                      {%- assign slide_product = block.settings.product -%}
                      {% if slide_product.available %}
                        <form action="{{ routes.cart_add_url }}" method="post" class="inline-flex">
                          <input type="hidden" name="id" value="{{ slide_product.first_available_variant.id }}">
                          <input type="hidden" name="quantity" value="1">
                          <button type="submit" class="inline-flex items-center gap-2 bg-white text-black text-sm font-bold px-5 py-2.5 rounded-xl hover:bg-white/90 transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                            Add to cart
                          </button>
                        </form>
                      {% endif %}
                    {% endif %}

                    {%- comment -%} View details link {%- endcomment -%}
                    {% if block.settings.link != blank %}
                      <a href="{{ block.settings.link }}" class="inline-flex items-center gap-1.5 text-sm font-semibold text-white/70 hover:text-white transition-colors no-underline px-3 py-2.5">
                        {{ block.settings.cta | default: 'View details' }}
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"/></svg>
                      </a>
                    {% endif %}
                  </div>

                  {% if block.settings.eyebrow != blank %}
                    <p class="text-[10px] font-semibold uppercase tracking-[0.15em] text-white/30 mt-4">{{ block.settings.eyebrow }}</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {%- comment -%} Navigation arrows {%- endcomment -%}
      {% if section.blocks.size > 1 %}
        <button data-carousel-prev class="absolute left-2 top-1/2 -translate-y-1/2 z-20 w-10 h-10 rounded-full bg-white/10 backdrop-blur-sm shadow-lg flex items-center justify-center text-white hover:bg-white/20 transition-all hidden md:flex" aria-label="Previous">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 19.5 8.25 12l7.5-7.5"/></svg>
        </button>
        <button data-carousel-next class="absolute right-2 top-1/2 -translate-y-1/2 z-20 w-10 h-10 rounded-full bg-white/10 backdrop-blur-sm shadow-lg flex items-center justify-center text-white hover:bg-white/20 transition-all hidden md:flex" aria-label="Next">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m8.25 4.5 7.5 7.5-7.5 7.5"/></svg>
        </button>
      {% endif %}

      {%- comment -%} Dots {%- endcomment -%}
      {% if section.blocks.size > 1 %}
        <div class="flex justify-center gap-2 mt-6" data-carousel-dots>
          {% for block in section.blocks %}
            <button data-carousel-dot="{{ forloop.index0 }}" class="w-2 h-2 rounded-full transition-all {% if forloop.first %}bg-white w-6{% else %}bg-white/20{% endif %}" aria-label="Slide {{ forloop.index }}"></button>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Product carousel",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Our shots"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "One shot, one function. Pick yours."
    }
  ],
  "blocks": [
    {
      "type": "product_slide",
      "name": "Product slide",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product (for Add to cart)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Display name",
          "default": "GINGR ENERGY"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Short description",
          "default": "Morning shot to kickstart your day."
        },
        {
          "type": "text",
          "id": "ingredients",
          "label": "Ingredients line",
          "default": "Ginger ¬∑ Lemon ¬∑ Guarana"
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge text (optional)",
          "default": "‚ö° Energy"
        },
        {
          "type": "text",
          "id": "eyebrow",
          "label": "Eyebrow (bottom, e.g. 60ml shot)"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Product image (PNG with transparency)"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Product page link"
        },
        {
          "type": "text",
          "id": "cta",
          "label": "View details text",
          "default": "View details"
        },
        {
          "type": "color",
          "id": "color_from",
          "label": "Gradient start",
          "default": "#ffd400"
        },
        {
          "type": "color",
          "id": "color_to",
          "label": "Gradient end",
          "default": "#c6a600"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product carousel",
      "blocks": [
        {
          "type": "product_slide",
          "settings": {
            "eyebrow": "60ml shot",
            "title": "GINGR ENERGY",
            "subtitle": "Morning shot to kickstart your day with clean energy.",
            "ingredients": "Ginger ¬∑ Lemon ¬∑ Guarana",
            "badge": "‚ö° Energy",
            "cta": "View details",
            "color_from": "#ffd400",
            "color_to": "#c6a600"
          }
        },
        {
          "type": "product_slide",
          "settings": {
            "eyebrow": "60ml shot",
            "title": "GINGR IMMUNITY",
            "subtitle": "Daily defense. Strengthen your immune system naturally.",
            "ingredients": "Ginger ¬∑ Turmeric ¬∑ Vitamin C",
            "badge": "üõ°Ô∏è Immunity",
            "cta": "View details",
            "color_from": "#e3a018",
            "color_to": "#9e6b00"
          }
        },
        {
          "type": "product_slide",
          "settings": {
            "eyebrow": "60ml shot",
            "title": "GINGR FOCUS",
            "subtitle": "Clarity & concentration for your work sessions.",
            "ingredients": "Ginger ¬∑ Ginseng ¬∑ Matcha",
            "badge": "üß† Focus",
            "cta": "View details",
            "color_from": "#006d77",
            "color_to": "#004b52"
          }
        },
        {
          "type": "product_slide",
          "settings": {
            "eyebrow": "60ml shot",
            "title": "GINGR DIGEST",
            "subtitle": "Support digestion after meals, naturally.",
            "ingredients": "Ginger ¬∑ Apple Cider ¬∑ Fennel",
            "badge": "üåø Digest",
            "cta": "View details",
            "color_from": "#7cb342",
            "color_to": "#558b2f"
          }
        },
        {
          "type": "product_slide",
          "settings": {
            "eyebrow": "60ml shot",
            "title": "GINGR RECOVER",
            "subtitle": "Post-workout recovery. Fight fatigue fast.",
            "ingredients": "Ginger ¬∑ Beetroot ¬∑ Magnesium",
            "badge": "üí™ Recover",
            "cta": "View details",
            "color_from": "#c1121f",
            "color_to": "#780000"
          }
        }
      ]
    }
  ]
}
{% endschema %}
