{%- comment -%}
  Brand Story / Product Highlight
  Full-width split layout: image + brand reliability info.
  Trust points are blocks â€” user can add/delete/reorder.
  Trust points placed after a Story block belong to that story.
{%- endcomment -%}

{%- assign block_count = section.blocks.size -%}

<section class="section-padding" data-section-id="{{ section.id }}">
  <div class="gingr-container">
    {%- assign story_num = 0 -%}

    {% for block in section.blocks %}
      {% if block.type == 'story' %}
        {%- assign story_num = story_num | plus: 1 -%}
        {%- assign remainder = story_num | modulo: 2 -%}
        {%- assign reversed = false -%}
        {% if remainder == 0 %}
          {%- assign reversed = true -%}
        {% endif %}
        {%- assign current_pos = forloop.index0 -%}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center mb-16 lg:mb-24" {{ block.shopify_attributes }}>

          {%- comment -%} Image side {%- endcomment -%}
          <div class="{% if reversed %}lg:order-2{% endif %}">
            {% if block.settings.image %}
              <div class="relative rounded-3xl overflow-hidden"
                   style="{% if block.settings.bg_color != blank %}background-color: {{ block.settings.bg_color }};{% endif %}">
                {{ block.settings.image | image_url: width: 900 | image_tag:
                  class: 'w-full h-auto',
                  loading: 'lazy',
                  widths: '400,600,900'
                }}
              </div>
            {% else %}
              <div class="aspect-[4/3] rounded-3xl bg-white/5 border border-white/10 flex items-center justify-center">
                <div class="text-center text-white/20">
                  <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Z"/></svg>
                  <p class="text-sm">Upload image in theme editor</p>
                </div>
              </div>
            {% endif %}
          </div>

          {%- comment -%} Content side {%- endcomment -%}
          <div class="{% if reversed %}lg:order-1{% endif %}">
            {% if block.settings.eyebrow != blank %}
              <p class="text-xs font-semibold uppercase tracking-[0.15em] text-subheading mb-2">{{ block.settings.eyebrow }}</p>
            {% endif %}

            <h2 class="text-2xl md:text-4xl font-bold leading-tight">{{ block.settings.heading }}</h2>

            {% if block.settings.description != blank %}
              <p class="text-base mt-4 leading-relaxed max-w-lg" style="opacity:0.6;">{{ block.settings.description }}</p>
            {% endif %}

            {%- comment -%} Trust points â€” blocks that follow this story {%- endcomment -%}
            {%- assign tp_items = '' -%}
            {%- for i in (1..block_count) -%}
              {%- assign check_pos = current_pos | plus: i -%}
              {%- if check_pos < block_count -%}
                {%- assign check_block = section.blocks[check_pos] -%}
                {%- if check_block.type == 'story' -%}
                  {%- break -%}
                {%- elsif check_block.type == 'trust_point' -%}
                  {%- if tp_items == '' -%}
                    {%- assign tp_items = check_pos | append: '' -%}
                  {%- else -%}
                    {%- assign tp_items = tp_items | append: ',' | append: check_pos -%}
                  {%- endif -%}
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
            {%- if tp_items != '' -%}
              {%- assign tp_indices = tp_items | split: ',' -%}
              <ul class="mt-6 space-y-3">
                {%- for idx in tp_indices -%}
                  {%- assign tp_block = section.blocks[idx] -%}
                  <li class="flex items-center gap-3" {{ tp_block.shopify_attributes }}>
                    {%- if tp_block.settings.emoji != blank -%}
                      <span class="flex-shrink-0 text-lg">{{ tp_block.settings.emoji }}</span>
                    {%- endif -%}
                    <span class="text-sm" style="opacity:0.6;">{{ tp_block.settings.text }}</span>
                  </li>
                {%- endfor -%}
              </ul>
            {%- endif -%}

            {% if block.settings.cta_text != blank %}
              <a href="{{ block.settings.cta_link }}" class="btn-secondary mt-6 no-underline inline-flex items-center gap-2">
                {{ block.settings.cta_text }}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"/></svg>
              </a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "Brand story",
  "tag": "section",
  "settings": [],
  "blocks": [
    {
      "type": "story",
      "name": "Story block",
      "settings": [
        {
          "type": "text",
          "id": "eyebrow",
          "label": "Eyebrow text",
          "default": "Our promise"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Ginger, done right."
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "We source the finest organic ginger and combine it with functional superfoods. No additives, no preservatives â€” just real ingredients that work."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Image background color (optional)"
        },
        {
          "type": "text",
          "id": "cta_text",
          "label": "Button text",
          "default": "Learn more"
        },
        {
          "type": "url",
          "id": "cta_link",
          "label": "Button link"
        }
      ]
    },
    {
      "type": "trust_point",
      "name": "Trust point",
      "settings": [
        {
          "type": "text",
          "id": "emoji",
          "label": "Emoji (optional)",
          "default": "âœ…"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "100% organic ginger base"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Brand story",
      "blocks": [
        {
          "type": "story",
          "settings": {
            "eyebrow": "Our ginger shots",
            "heading": "Real ingredients. Real function.",
            "description": "We combine fresh organic ginger with functional superfoods and turn them into powerful 60ml shots. Raw, potent, and effective â€” no gimmicks."
          }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "âœ…", "text": "100% organic ginger base" }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "âœ…", "text": "Cold-pressed for maximum potency" }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "ðŸš«", "text": "No additives Â· No preservatives Â· No fillers" }
        },
        {
          "type": "story",
          "settings": {
            "eyebrow": "Built for your routine",
            "heading": "One shot a day. Feel the difference.",
            "description": "Each GINGR shot is designed around a single function. Energy, Immunity, Focus, Digest, or Recovery â€” pick the one that fits your day."
          }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "ðŸŽ¯", "text": "1 shot = 1 function" }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "ðŸ“…", "text": "Designed for daily use" }
        },
        {
          "type": "trust_point",
          "settings": { "emoji": "ðŸ’°", "text": "Subscribe & save 15%" }
        }
      ]
    }
  ]
}
{% endschema %}
